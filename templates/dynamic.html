<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Page - Playwright Test Server</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <header class="header">
        <nav class="nav">
            <div class="nav-brand">Playwright Test Server</div>
            <ul class="nav-menu">
                <li><a href="/" class="nav-link">Home</a></li>
                <li><a href="/forms" class="nav-link">Forms</a></li>
                <li><a href="/modal" class="nav-link">Modals</a></li>
                <li><a href="/dynamic/test1" class="nav-link">Dynamic Page 1</a></li>
                <li><a href="/dynamic/test2" class="nav-link">Dynamic Page 2</a></li>
            </ul>
        </nav>
    </header>

    <main class="main">
        <section class="hero">
            <h1 class="hero-title">Dynamic Page: {{ page_id }}</h1>
            <p class="hero-subtitle">This page demonstrates dynamic content loading and navigation</p>
        </section>

        <section class="content">
            <!-- Page Information -->
            <div class="card">
                <h2 id="page-info">Page Information</h2>
                <div class="info-grid">
                    <div class="info-item">
                        <strong>Page ID:</strong> <span id="page-id">{{ page_id }}</span>
                    </div>
                    <div class="info-item">
                        <strong>Current URL:</strong> <span id="current-url"></span>
                    </div>
                    <div class="info-item">
                        <strong>Timestamp:</strong> <span id="timestamp"></span>
                    </div>
                    <div class="info-item">
                        <strong>Random ID:</strong> <span id="random-id"></span>
                    </div>
                </div>
            </div>

            <!-- Dynamic Content Loading -->
            <div class="card">
                <h2 id="dynamic-content-section">Dynamic Content Loading</h2>
                <div class="button-group">
                    <button id="load-api-data" class="btn btn-primary">Load API Data</button>
                    <button id="load-simulated-data" class="btn btn-secondary">Load Simulated Data</button>
                    <button id="load-error-data" class="btn btn-danger">Load Error Data</button>
                    <button id="clear-content" class="btn btn-warning">Clear Content</button>
                </div>
                <div id="dynamic-content-area" class="dynamic-content-area">
                    <p class="placeholder-text">Click a button above to load dynamic content</p>
                </div>
            </div>

            <!-- Navigation Testing -->
            <div class="card">
                <h2 id="navigation-section">Navigation Testing</h2>
                <div class="button-group">
                    <a href="/" class="btn btn-primary">Go to Home</a>
                    <a href="/forms" class="btn btn-secondary">Go to Forms</a>
                    <a href="/modal" class="btn btn-info">Go to Modals</a>
                    <a href="/dynamic/test1" class="btn btn-warning">Go to Test 1</a>
                    <a href="/dynamic/test2" class="btn btn-success">Go to Test 2</a>
                </div>
                <div class="button-group">
                    <button id="navigate-back" class="btn btn-secondary">Go Back</button>
                    <button id="navigate-forward" class="btn btn-secondary">Go Forward</button>
                    <button id="refresh-page" class="btn btn-warning">Refresh Page</button>
                </div>
            </div>

            <!-- State Management -->
            <div class="card">
                <h2 id="state-section">State Management</h2>
                <div class="form-group">
                    <label for="state-input" class="form-label">State Input</label>
                    <input type="text" id="state-input" class="form-input" placeholder="Enter some text to persist">
                </div>
                <div class="button-group">
                    <button id="save-state" class="btn btn-primary">Save State</button>
                    <button id="load-state" class="btn btn-secondary">Load State</button>
                    <button id="clear-state" class="btn btn-danger">Clear State</button>
                </div>
                <div id="state-display" class="state-display">
                    <p>No state saved yet</p>
                </div>
            </div>

            <!-- Event Testing -->
            <div class="card">
                <h2 id="events-section">Event Testing</h2>
                <div class="event-testing-area">
                    <div class="event-item">
                        <button id="click-event" class="btn btn-primary">Click Event</button>
                        <span id="click-count">Clicks: 0</span>
                    </div>
                    <div class="event-item">
                        <button id="double-click-event" class="btn btn-secondary">Double Click Event</button>
                        <span id="double-click-count">Double Clicks: 0</span>
                    </div>
                    <div class="event-item">
                        <button id="right-click-event" class="btn btn-info">Right Click Event</button>
                        <span id="right-click-count">Right Clicks: 0</span>
                    </div>
                    <div class="event-item">
                        <input type="text" id="keyboard-event" class="form-input" placeholder="Type here for keyboard events">
                        <span id="keyboard-count">Key presses: 0</span>
                    </div>
                    <div class="event-item">
                        <div id="mouse-area" class="mouse-area">
                            <p>Move your mouse over this area</p>
                            <span id="mouse-coords">X: 0, Y: 0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Conditional Content -->
            <div class="card">
                <h2 id="conditional-section">Conditional Content</h2>
                <div class="button-group">
                    <button id="toggle-content" class="btn btn-primary">Toggle Content</button>
                    <button id="show-content" class="btn btn-success">Show Content</button>
                    <button id="hide-content" class="btn btn-danger">Hide Content</button>
                </div>
                <div id="conditional-content" class="conditional-content" style="display: none;">
                    <h3>Conditional Content</h3>
                    <p>This content can be shown or hidden based on user actions.</p>
                    <ul>
                        <li>Item 1</li>
                        <li>Item 2</li>
                        <li>Item 3</li>
                    </ul>
                </div>
            </div>

            <!-- Form with Dynamic Validation -->
            <div class="card">
                <h2 id="dynamic-form-section">Dynamic Form</h2>
                <form id="dynamic-form" class="form">
                    <div class="form-group">
                        <label for="dynamic-username" class="form-label">Username</label>
                        <input type="text" id="dynamic-username" name="username" class="form-input" placeholder="Enter username">
                        <div id="username-validation" class="validation-message"></div>
                    </div>
                    <div class="form-group">
                        <label for="dynamic-email" class="form-label">Email</label>
                        <input type="email" id="dynamic-email" name="email" class="form-input" placeholder="Enter email">
                        <div id="email-validation" class="validation-message"></div>
                    </div>
                    <div class="form-group">
                        <label for="dynamic-password" class="form-label">Password</label>
                        <input type="password" id="dynamic-password" name="password" class="form-input" placeholder="Enter password">
                        <div id="password-strength" class="password-strength"></div>
                    </div>
                    <button type="submit" class="btn btn-primary">Submit Dynamic Form</button>
                </form>
            </div>
        </section>
    </main>

    <script src="/static/script.js"></script>
    <script>
        // Dynamic page specific JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize page information
            initializePageInfo();
            
            // Initialize dynamic content loading
            initializeDynamicContent();
            
            // Initialize navigation
            initializeNavigation();
            
            // Initialize state management
            initializeStateManagement();
            
            // Initialize event testing
            initializeEventTesting();
            
            // Initialize conditional content
            initializeConditionalContent();
            
            // Initialize dynamic form
            initializeDynamicForm();
        });

        function initializePageInfo() {
            document.getElementById('current-url').textContent = window.location.href;
            document.getElementById('timestamp').textContent = new Date().toLocaleString();
            document.getElementById('random-id').textContent = Math.random().toString(36).substr(2, 9);
        }

        function initializeDynamicContent() {
            const loadApiData = document.getElementById('load-api-data');
            const loadSimulatedData = document.getElementById('load-simulated-data');
            const loadErrorData = document.getElementById('load-error-data');
            const clearContent = document.getElementById('clear-content');
            const contentArea = document.getElementById('dynamic-content-area');

            loadApiData?.addEventListener('click', async () => {
                contentArea.innerHTML = '<p>Loading API data...</p>';
                try {
                    const response = await fetch('/api/users');
                    const data = await response.json();
                    
                    const html = `
                        <h3>API Data Loaded</h3>
                        <table class="table">
                            <thead>
                                <tr><th>ID</th><th>Name</th><th>Email</th></tr>
                            </thead>
                            <tbody>
                                ${data.users.map(user => `
                                    <tr>
                                        <td>${user.id}</td>
                                        <td>${user.name}</td>
                                        <td>${user.email}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                    contentArea.innerHTML = html;
                } catch (error) {
                    contentArea.innerHTML = '<p class="error">Failed to load API data</p>';
                }
            });

            loadSimulatedData?.addEventListener('click', () => {
                const simulatedData = [
                    { id: 1, name: 'Simulated Item 1', value: Math.random() },
                    { id: 2, name: 'Simulated Item 2', value: Math.random() },
                    { id: 3, name: 'Simulated Item 3', value: Math.random() }
                ];
                
                const html = `
                    <h3>Simulated Data Loaded</h3>
                    <ul>
                        ${simulatedData.map(item => `
                            <li><strong>${item.name}</strong>: ${item.value.toFixed(4)}</li>
                        `).join('')}
                    </ul>
                `;
                contentArea.innerHTML = html;
            });

            loadErrorData?.addEventListener('click', () => {
                contentArea.innerHTML = `
                    <div class="alert alert-error">
                        <strong>Error!</strong> This is a simulated error for testing purposes.
                    </div>
                `;
            });

            clearContent?.addEventListener('click', () => {
                contentArea.innerHTML = '<p class="placeholder-text">Click a button above to load dynamic content</p>';
            });
        }

        function initializeNavigation() {
            document.getElementById('navigate-back')?.addEventListener('click', () => {
                window.history.back();
            });

            document.getElementById('navigate-forward')?.addEventListener('click', () => {
                window.history.forward();
            });

            document.getElementById('refresh-page')?.addEventListener('click', () => {
                window.location.reload();
            });
        }

        function initializeStateManagement() {
            const stateInput = document.getElementById('state-input');
            const saveState = document.getElementById('save-state');
            const loadState = document.getElementById('load-state');
            const clearState = document.getElementById('clear-state');
            const stateDisplay = document.getElementById('state-display');

            saveState?.addEventListener('click', () => {
                const value = stateInput.value;
                if (value.trim()) {
                    localStorage.setItem('dynamicPageState', value);
                    stateDisplay.innerHTML = `<p>State saved: "${value}"</p>`;
                    showAlert('success', 'State saved successfully!');
                } else {
                    showAlert('error', 'Please enter some text to save');
                }
            });

            loadState?.addEventListener('click', () => {
                const savedState = localStorage.getItem('dynamicPageState');
                if (savedState) {
                    stateInput.value = savedState;
                    stateDisplay.innerHTML = `<p>State loaded: "${savedState}"</p>`;
                    showAlert('success', 'State loaded successfully!');
                } else {
                    stateDisplay.innerHTML = '<p>No state found</p>';
                    showAlert('info', 'No saved state found');
                }
            });

            clearState?.addEventListener('click', () => {
                localStorage.removeItem('dynamicPageState');
                stateInput.value = '';
                stateDisplay.innerHTML = '<p>State cleared</p>';
                showAlert('success', 'State cleared successfully!');
            });
        }

        function initializeEventTesting() {
            let clickCount = 0;
            let doubleClickCount = 0;
            let rightClickCount = 0;
            let keyboardCount = 0;

            document.getElementById('click-event')?.addEventListener('click', () => {
                clickCount++;
                document.getElementById('click-count').textContent = `Clicks: ${clickCount}`;
            });

            document.getElementById('double-click-event')?.addEventListener('dblclick', () => {
                doubleClickCount++;
                document.getElementById('double-click-count').textContent = `Double Clicks: ${doubleClickCount}`;
            });

            document.getElementById('right-click-event')?.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                rightClickCount++;
                document.getElementById('right-click-count').textContent = `Right Clicks: ${rightClickCount}`;
            });

            document.getElementById('keyboard-event')?.addEventListener('keydown', () => {
                keyboardCount++;
                document.getElementById('keyboard-count').textContent = `Key presses: ${keyboardCount}`;
            });

            const mouseArea = document.getElementById('mouse-area');
            const mouseCoords = document.getElementById('mouse-coords');
            
            mouseArea?.addEventListener('mousemove', (e) => {
                const rect = mouseArea.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                mouseCoords.textContent = `X: ${Math.round(x)}, Y: ${Math.round(y)}`;
            });
        }

        function initializeConditionalContent() {
            const toggleContent = document.getElementById('toggle-content');
            const showContent = document.getElementById('show-content');
            const hideContent = document.getElementById('hide-content');
            const conditionalContent = document.getElementById('conditional-content');

            toggleContent?.addEventListener('click', () => {
                if (conditionalContent.style.display === 'none') {
                    conditionalContent.style.display = 'block';
                } else {
                    conditionalContent.style.display = 'none';
                }
            });

            showContent?.addEventListener('click', () => {
                conditionalContent.style.display = 'block';
            });

            hideContent?.addEventListener('click', () => {
                conditionalContent.style.display = 'none';
            });
        }

        function initializeDynamicForm() {
            const form = document.getElementById('dynamic-form');
            const username = document.getElementById('dynamic-username');
            const email = document.getElementById('dynamic-email');
            const password = document.getElementById('dynamic-password');

            // Real-time validation
            username?.addEventListener('input', () => {
                const value = username.value;
                const validation = document.getElementById('username-validation');
                
                if (value.length < 3) {
                    validation.textContent = 'Username must be at least 3 characters';
                    validation.className = 'validation-message error';
                } else if (value.length > 20) {
                    validation.textContent = 'Username must be less than 20 characters';
                    validation.className = 'validation-message error';
                } else {
                    validation.textContent = 'Username is valid';
                    validation.className = 'validation-message success';
                }
            });

            email?.addEventListener('input', () => {
                const value = email.value;
                const validation = document.getElementById('email-validation');
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                
                if (value && !emailRegex.test(value)) {
                    validation.textContent = 'Please enter a valid email address';
                    validation.className = 'validation-message error';
                } else if (value) {
                    validation.textContent = 'Email is valid';
                    validation.className = 'validation-message success';
                } else {
                    validation.textContent = '';
                    validation.className = 'validation-message';
                }
            });

            password?.addEventListener('input', () => {
                const value = password.value;
                const strength = document.getElementById('password-strength');
                
                let strengthText = '';
                let strengthClass = '';
                
                if (value.length === 0) {
                    strengthText = '';
                } else if (value.length < 6) {
                    strengthText = 'Weak';
                    strengthClass = 'weak';
                } else if (value.length < 10) {
                    strengthText = 'Medium';
                    strengthClass = 'medium';
                } else {
                    strengthText = 'Strong';
                    strengthClass = 'strong';
                }
                
                strength.textContent = strengthText;
                strength.className = `password-strength ${strengthClass}`;
            });

            form?.addEventListener('submit', (e) => {
                e.preventDefault();
                const formData = new FormData(form);
                const data = Object.fromEntries(formData.entries());
                
                showAlert('success', 'Dynamic form submitted successfully!');
                console.log('Form data:', data);
            });
        }
    </script>

    <style>
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .info-item {
            padding: 12px;
            background-color: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #007bff;
        }

        .dynamic-content-area {
            margin-top: 16px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 6px;
            min-height: 100px;
        }

        .placeholder-text {
            color: #666;
            font-style: italic;
        }

        .state-display {
            margin-top: 16px;
            padding: 12px;
            background-color: #e3f2fd;
            border-radius: 6px;
            border-left: 4px solid #2196f3;
        }

        .event-testing-area {
            display: grid;
            gap: 16px;
        }

        .event-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background-color: #f8f9fa;
            border-radius: 6px;
        }

        .mouse-area {
            padding: 20px;
            background-color: #e8f5e8;
            border: 2px dashed #4caf50;
            border-radius: 6px;
            text-align: center;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .conditional-content {
            margin-top: 16px;
            padding: 20px;
            background-color: #fff3cd;
            border-radius: 6px;
            border-left: 4px solid #ffc107;
        }

        .validation-message {
            margin-top: 4px;
            font-size: 12px;
        }

        .validation-message.error {
            color: #dc3545;
        }

        .validation-message.success {
            color: #28a745;
        }

        .password-strength {
            margin-top: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .password-strength.weak {
            color: #dc3545;
        }

        .password-strength.medium {
            color: #ffc107;
        }

        .password-strength.strong {
            color: #28a745;
        }

        .error {
            color: #dc3545;
        }
    </style>
</body>
</html> 